<form class="{{cssClass}} flexcol" autocomplete="off">
  <header class="sheet-header">
    <h1 class="character-title">{{actor.name}}</h1>
    
    <div class="character-info">
      <div class="form-group">
        <label>Personal Name:</label>
        <input name="system.details.characterName" type="text" value="{{system.details.characterName}}" placeholder="Character Name"/>
      </div>
      
      <div class="form-group">
        <label>Story Archetype:</label>
        <input name="system.details.archetype" type="text" value="{{system.details.archetype}}" placeholder="Ambitious nobleman with delusions of grandeur"/>
      </div>
      
      <div class="form-row">
        <div class="form-group expanded">
          <label>Praesi Virtues:</label>
          <textarea name="system.details.praesiVirtues" rows="2" placeholder="Virtues">{{system.details.praesiVirtues}}</textarea>
        </div>
        
        <div class="form-group expanded">
          <label>Major Flaws:</label>
          <textarea name="system.details.majorFlaws" rows="2" placeholder="Major Flaws">{{system.details.majorFlaws}}</textarea>
        </div>
      </div>
    </div>
  </header>

  <div class="sheet-body">
    <div class="tab-container">
      <nav class="sheet-tabs tabs" data-group="primary">
        <a class="item active" data-tab="main">Character Sheet</a>
        <a class="item" data-tab="biography">Notes</a>
      </nav>

      <div class="tab-content">
        <div class="tab main active" data-group="primary" data-tab="main">
    <!-- Stats Table -->
    <div class="stats-section">
      <h3>Stats</h3>
      <table class="stats-table">
        <thead>
          <tr>
            <th>Stat</th>
            <th>Uses</th>
            <th>Die</th>
            <th>Roll</th>
          </tr>
        </thead>
        <tbody>
          {{#each system.stats as |stat key|}}
          <tr>
            <td class="stat-name">
              <button type="button" class="roll-stat-name" data-stat="{{stat.label}}" data-die="{{stat.value}}">{{stat.label}}</button>
            </td>
            <td class="stat-uses">{{stat.uses}}</td>
            <td class="stat-die">
              <select name="system.stats.{{key}}.value">
                <option value="d4" {{#if (eq stat.value "d4")}}selected{{/if}}>d4</option>
                <option value="d6" {{#if (eq stat.value "d6")}}selected{{/if}}>d6</option>
                <option value="d8" {{#if (eq stat.value "d8")}}selected{{/if}}>d8</option>
                <option value="d10" {{#if (eq stat.value "d10")}}selected{{/if}}>d10</option>
                <option value="d12" {{#if (eq stat.value "d12")}}selected{{/if}}>d12</option>
                <option value="d20" {{#if (eq stat.value "d20")}}selected{{/if}}>d20</option>
              </select>
            </td>
          </tr>
          {{/each}}
        </tbody>
      </table>
    </div>

    <!-- Resources Row -->
    <div class="resources-row">
      <div class="resource-group">
        <div class="hits-section">
          <label>Base Hits: <input name="system.resources.hits.max" type="number" value="{{system.resources.hits.max}}" min="1" max="10" class="base-hits"/></label>
          <div class="hits-control">
            <div class="toggle-buttons">
              <button type="button" class="hits-up">▲</button>
              <button type="button" class="hits-down">▼</button>
            </div>
            <div class="hits-display">
              {{#times system.resources.hits.value}}
                <span class="hit-marker filled">●</span>
              {{/times}}
              {{#times (subtract system.resources.hits.max system.resources.hits.value)}}
                <span class="hit-marker empty">○</span>
              {{/times}}
            </div>
          </div>
        </div>
      </div>
      
      <div class="resource-group">
        <label>Story Tokens</label>
        <div class="tokens-control">
          <div class="tokens-display">{{system.resources.storyTokens.value}}</div>
          <div class="toggle-buttons">
            <button type="button" class="tokens-up">▲</button>
            <button type="button" class="tokens-down">▼</button>
          </div>
        </div>
      </div>
      
      <div class="resource-group">
        <label>Story Die</label>
        <div class="story-die-control">
          <select name="system.resources.storyDie.value" class="story-die-select">
            <option value="d4" {{#if (eq system.resources.storyDie.value "d4")}}selected{{/if}}>d4</option>
            <option value="d6" {{#if (eq system.resources.storyDie.value "d6")}}selected{{/if}}>d6</option>
            <option value="d8" {{#if (eq system.resources.storyDie.value "d8")}}selected{{/if}}>d8</option>
            <option value="d10" {{#if (eq system.resources.storyDie.value "d10")}}selected{{/if}}>d10</option>
            <option value="d12" {{#if (eq system.resources.storyDie.value "d12")}}selected{{/if}}>d12</option>
            <option value="d20" {{#if (eq system.resources.storyDie.value "d20")}}selected{{/if}}>d20</option>
          </select>
          <button type="button" class="roll-story-die">Roll Story Die</button>
        </div>
      </div>
    </div>

    <!-- Aspects in 3 columns -->
    <div class="aspects-section">
      <h3>Aspects</h3>
      <p><em>Choose 2 at start, gain 3rd through play</em></p>
      
      <div class="aspects-grid">
        <div class="aspect-column">
          <div class="aspect-block">
            <div class="aspect-header">
              <label>1st Aspect:</label>
              <input name="system.aspects.aspect1.name" type="text" value="{{system.aspects.aspect1.name}}" placeholder="Aspect Name"/>
            </div>
            <div class="aspect-details">
              <div class="form-group">
                <label>Nature:</label>
                <textarea name="system.aspects.aspect1.nature" rows="2" placeholder="Its groove in the story">{{system.aspects.aspect1.nature}}</textarea>
              </div>
              <div class="aspect-buttons">
                <button type="button" class="roll-aspect" data-die="d4" data-type="Passive" data-name="{{system.aspects.aspect1.name}}">+D4 Passive</button>
                <button type="button" class="roll-aspect" data-die="d12" data-type="Active" data-name="{{system.aspects.aspect1.name}}">+D12 Active</button>
              </div>
            </div>
          </div>
        </div>

        <div class="aspect-column">
          <div class="aspect-block">
            <div class="aspect-header">
              <label>2nd Aspect:</label>
              <input name="system.aspects.aspect2.name" type="text" value="{{system.aspects.aspect2.name}}" placeholder="Aspect Name"/>
            </div>
            <div class="aspect-details">
              <div class="form-group">
                <label>Nature:</label>
                <textarea name="system.aspects.aspect2.nature" rows="2" placeholder="Its groove in the story">{{system.aspects.aspect2.nature}}</textarea>
              </div>
              <div class="aspect-buttons">
                <button type="button" class="roll-aspect" data-die="d4" data-type="Passive" data-name="{{system.aspects.aspect2.name}}">+D4 Passive</button>
                <button type="button" class="roll-aspect" data-die="d12" data-type="Active" data-name="{{system.aspects.aspect2.name}}">+D12 Active</button>
              </div>
            </div>
          </div>
        </div>

        <div class="aspect-column">
          <div class="aspect-block">
            <div class="aspect-header">
              <label>3rd Aspect:</label>
              <input name="system.aspects.aspect3.name" type="text" value="{{system.aspects.aspect3.name}}" placeholder="Aspect Name"/>
            </div>
            <div class="aspect-details">
              <div class="form-group">
                <label>Nature:</label>
                <textarea name="system.aspects.aspect3.nature" rows="2" placeholder="Its groove in the story">{{system.aspects.aspect3.nature}}</textarea>
              </div>
              <div class="aspect-buttons">
                <button type="button" class="roll-aspect" data-die="d4" data-type="Passive" data-name="{{system.aspects.aspect3.name}}">+D4 Passive</button>
                <button type="button" class="roll-aspect" data-die="d20" data-type="Active" data-name="{{system.aspects.aspect3.name}}">+D20 Active</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Item Dice and Rule of Cool -->
    <div class="bonus-dice-section">
      <div class="item-dice-group">
        <h4>Item Dice</h4>
        <div class="item-dice-row">
          <input name="system.bonusDice.item1.name" type="text" value="{{system.bonusDice.item1.name}}" placeholder="Item"/>
          <select name="system.bonusDice.item1.die">
            <option value="">—</option>
            <option value="d4" {{#if (eq system.bonusDice.item1.die "d4")}}selected{{/if}}>d4</option>
            <option value="d6" {{#if (eq system.bonusDice.item1.die "d6")}}selected{{/if}}>d6</option>
            <option value="d8" {{#if (eq system.bonusDice.item1.die "d8")}}selected{{/if}}>d8</option>
            <option value="d10" {{#if (eq system.bonusDice.item1.die "d10")}}selected{{/if}}>d10</option>
            <option value="d12" {{#if (eq system.bonusDice.item1.die "d12")}}selected{{/if}}>d12</option>
            <option value="d20" {{#if (eq system.bonusDice.item1.die "d20")}}selected{{/if}}>d20</option>
          </select>
          <button type="button" class="roll-item" data-die="{{system.bonusDice.item1.die}}" data-name="{{system.bonusDice.item1.name}}">Roll</button>
        </div>
        <div class="item-dice-row">
          <input name="system.bonusDice.item2.name" type="text" value="{{system.bonusDice.item2.name}}" placeholder="Item"/>
          <select name="system.bonusDice.item2.die">
            <option value="">—</option>
            <option value="d4" {{#if (eq system.bonusDice.item2.die "d4")}}selected{{/if}}>d4</option>
            <option value="d6" {{#if (eq system.bonusDice.item2.die "d6")}}selected{{/if}}>d6</option>
            <option value="d8" {{#if (eq system.bonusDice.item2.die "d8")}}selected{{/if}}>d8</option>
            <option value="d10" {{#if (eq system.bonusDice.item2.die "d10")}}selected{{/if}}>d10</option>
            <option value="d12" {{#if (eq system.bonusDice.item2.die "d12")}}selected{{/if}}>d12</option>
            <option value="d20" {{#if (eq system.bonusDice.item2.die "d20")}}selected{{/if}}>d20</option>
          </select>
          <button type="button" class="roll-item" data-die="{{system.bonusDice.item2.die}}" data-name="{{system.bonusDice.item2.name}}">Roll</button>
        </div>
        <div class="item-dice-row">
          <input name="system.bonusDice.item3.name" type="text" value="{{system.bonusDice.item3.name}}" placeholder="Item"/>
          <select name="system.bonusDice.item3.die">
            <option value="">—</option>
            <option value="d4" {{#if (eq system.bonusDice.item3.die "d4")}}selected{{/if}}>d4</option>
            <option value="d6" {{#if (eq system.bonusDice.item3.die "d6")}}selected{{/if}}>d6</option>
            <option value="d8" {{#if (eq system.bonusDice.item3.die "d8")}}selected{{/if}}>d8</option>
            <option value="d10" {{#if (eq system.bonusDice.item3.die "d10")}}selected{{/if}}>d10</option>
            <option value="d12" {{#if (eq system.bonusDice.item3.die "d12")}}selected{{/if}}>d12</option>
            <option value="d20" {{#if (eq system.bonusDice.item3.die "d20")}}selected{{/if}}>d20</option>
          </select>
          <button type="button" class="roll-item" data-die="{{system.bonusDice.item3.die}}" data-name="{{system.bonusDice.item3.name}}">Roll</button>
        </div>
      </div>

      <div class="rule-of-cool-group">
        <h4>Rule of Cool</h4>
        <button type="button" class="roll-extra" data-die="d4">Roll D4</button>
      </div>
    </div>

    <!-- Items List -->
    <div class="items-section">
      <h3>Items</h3>
      <div class="items-list">
        <div class="item-row">
          <input name="system.equipment.item1.name" type="text" value="{{system.equipment.item1.name}}" placeholder="Item Name"/>
          <input name="system.equipment.item1.quantity" type="number" value="{{system.equipment.item1.quantity}}" min="0" class="qty-input"/>
          <div class="toggle-buttons">
            <button type="button" class="item-qty-up" data-item="item1">▲</button>
            <button type="button" class="item-qty-down" data-item="item1">▼</button>
          </div>
        </div>
        <div class="item-row">
          <input name="system.equipment.item2.name" type="text" value="{{system.equipment.item2.name}}" placeholder="Item Name"/>
          <input name="system.equipment.item2.quantity" type="number" value="{{system.equipment.item2.quantity}}" min="0" class="qty-input"/>
          <div class="toggle-buttons">
            <button type="button" class="item-qty-up" data-item="item2">▲</button>
            <button type="button" class="item-qty-down" data-item="item2">▼</button>
          </div>
        </div>
        <div class="item-row">
          <input name="system.equipment.item3.name" type="text" value="{{system.equipment.item3.name}}" placeholder="Item Name"/>
          <input name="system.equipment.item3.quantity" type="number" value="{{system.equipment.item3.quantity}}" min="0" class="qty-input"/>
          <div class="toggle-buttons">
            <button type="button" class="item-qty-up" data-item="item3">▲</button>
            <button type="button" class="item-qty-down" data-item="item3">▼</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Pattern of Three Notes -->
    <div class="notes-section">
      <div class="notes-label">
        <label>Patterns of Three:</label>
      </div>
      <div class="notes-area">
        <textarea name="system.notes.patternOfThree" rows="3" placeholder="Notes about patterns, recurring themes, or story elements...">{{system.notes.patternOfThree}}</textarea>
      </div>
    </div>
        </div>

        <div class="tab biography" data-group="primary" data-tab="biography">
          <div class="biography-section">
            <h3>Biography & Notes</h3>
            <textarea name="system.biography" rows="10" placeholder="Character backstory, motivations, connections, etc.">{{system.biography}}</textarea>
          </div>
        </div>
      </div>
    </div>
  </div>
</form>